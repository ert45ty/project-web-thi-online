<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments::head('Bài thi')">
</head>
<body class="ec-header-fixed ec-sidebar-fixed ec-sidebar-dark ec-header-light" id="body">
<div class="wrapper">
  <div th:replace="fragments::sidebar('exams')"></div>
  <div class="ec-page-wrapper">
    <header th:replace="fragments::header('exam')"></header>
    <div class="ec-content-wrapper">
      <div class="content">
        <div class="row">
          <div class="col-xl-9 col-lg-9 mx-auto">
            <div class="ec-cat-list card card-default mb-24px">
              <div class="card-body">
                <div class="ec-cat-form">

                  <form id="form" th:action="@{/admin/exam/createQandA(examId=${examId},totalQuestion=${totalQuestion})}"
                        method="post" th:object="${questions}" enctype="multipart/form-data">
                    <div th:each="i : ${#numbers.sequence(0, totalQuestion - 1)}" class="allQuestion"
                         th:id="'question-'+ ${i+1}">
                    <h4 th:text="'Câu hỏi số ' + ${i + 1}"></h4>
                    <div class="form-group row">
                      <label class="col-12 col-form-label">Nội dung câu hỏi:</label>
                      <div class="col-12">
                        <textarea th:id="'questionDtoList['+${i}+ '].question_text'" th:name="'questionDtoList['+${i}+ '].question_text'" cols="40" rows="2" class="form-control" th:field="*{questionDtoList[__${i}__].question_text}" required></textarea>
                      </div>
                      <label th:if="${#fields.hasErrors('questionDtoList['+i+'].question_text')}" th:errors="*{questionDtoList[__${i}__].question_text}" th:for="'questionDtoList['+${i}+ '].question_text'" class="form-label text-danger"></label>
                    </div>
                    <div class="form-group row">
                      <label class="col-12 col-form-label">Hình ảnh</label>
                      <div class="col-12">
                        <input th:id="'questionDtoList['+${i}+'].fileImage'" th:name="'questionDtoList['+${i}+'].fileImage'" class="form-control here slug-title" type="file" accept="image/*" th:onchange="|previewImage(event, ${i})|">
                        <br><br>
                        <img th:id="imagePreview+${i}"  src="#" alt="Ảnh xem trước" style="display: none; width: 200px; height: auto;">
                        <br><br>
                      </div>
                    </div>
                    <div th:each="j :${#numbers.sequence(0, 3)}">
                    <div class="form-group row">
                      <div class="d-flex">
                        <label th:for="'questionDtoList['+${i}+'].options['+${j}+']'">Lựa chọn:</label>
                        <input type="text" th:id="'questionDtoList['+${i}+'].options['+${j}+']'" th:name="'questionDtoList['+${i}+'].options'" th:field="*{questionDtoList[__${i}__].options[__${j}__].option_text}" placeholder="Nhập câu trả lời" required class="mr-1"/>
                      </div>
                      <label th:if="${#fields.hasErrors('questionDtoList['+i+'].options['+j+'].option_text')}" th:errors="*{questionDtoList[__${i}__].options[__${j}__].option_text}" th:for="'questionDtoList['+${i}+'].options['+${j}+']'" class="form-label text-danger"></label>
                    </div>
                </div>
                    <div class="form-group row">
                      <label class="col-12 col-form-label">Đáp án đúng:</label>
                      <select name="correct" th:id="'correctAnswer'+${i}" class="form-select" th:field="*{questionDtoList[__${i}__].correct}">
                        <th:block th:each="h : ${#numbers.sequence(0,3)}">
                          <option  th:value="${h}" th:text="'Đáp án ' + ${h+1}"></option></th:block>
                      </select>
                    </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <div class="col-xl-3 col-lg-3 mx-auto" >
            <div class="ec-cat-list card card-default mb-24px">
              <div class="card-body">
                <h4>Bảng câu hỏi</h4>
                <div class="mt-3 d-flex flex-wrap" >
                  <div th:each="m : ${#numbers.sequence(1,totalQuestion)}" >
                    <button class="btn-exam" name="action"
                            th:onclick="|updateIndex(${m})|"
                            th:value="${m}"
                            th:text="${m}"
                            th:id="'button'+ ${m}"/>
                  </div>
                </div>
                <br/>
                <div class="d-flex justify-content-between">
                  <button name="action" onclick="decrement()">Câu trước</button>
                  <button name="action" th:onclick="|increment(${totalQuestion})|">Câu tiếp</button>
                </div>
                <div>
                  <button class="mt-3" type="submit" name="finish" onclick="submitForm()">Hoàn thành...</button></div>
              </div>
            </div>
          </div>

        </div>
        </div>
      </div>
    </div>
  </div>
</div>
<footer th:replace="fragments::footer()"></footer>
<script>
  let index = 1;
  increment = (max)=>{
    if (index < max){
      index++;
      updateVisibility();}
  }
  decrement = ()=>{
    if (index > 1){
      index--;
      updateVisibility();}
  }

  updateIndex = (value)=>{
    index = value;
    updateVisibility();
  }

  updateVisibility = () =>{
    let allQuestion = document.querySelectorAll(".allQuestion")
    allQuestion.forEach((question) =>{
      question.style.display = 'none';
    });
    let currentQuestion = document.getElementById('question-' + index);
    if (currentQuestion) {
      currentQuestion.style.display = 'block';
    }

  }
  window.onload = ()=>{
    updateVisibility();
  }
  function submitForm(){
    document.getElementById("form").submit();
  }
  // document.getElementById('form').addEventListener('submit', function(e) {
  //   // Lặp qua tất cả các câu hỏi
  //   for (let i = 0; i < [[${totalQuestion != null ? totalQuestion : 10}]]; i++) {
  //     const select = document.getElementById('correctAnswer' + i);
  //     const selectedIndex = select.value;
  //
  //     // Đặt tất cả các lựa chọn là false
  //     for (let j = 0; j < 4; j++) {
  //       const optionField = document.querySelector(`input[name="questionDtoList[${i}].options[${j}].is_correct"]`);
  //       optionField.value = (j == selectedIndex) ? "true" : "false";
  //     }
  //   }
  // });

</script>
</body>
</html>